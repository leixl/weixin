(function(V){var E=V.fn.domManip,S="_tmplitem",F=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,U={},Q={},R,G={key:0,data:{}},N=0,T=0,K=[];function P(f,i,b,a){var j={data:a||(i?i.data:{}),_wrap:i?i._wrap:null,tmpl:null,parent:i||null,nodes:[],calls:B,nest:z,wrap:y,html:A,update:C};f&&V.extend(j,f,{nodes:[],parent:i});if(b){j.tmpl=b;j._ctnt=j._ctnt||j.tmpl(V,j);j.key=++N;(K.length?Q:U)[N]=j}return j}V.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){V.fn[a]=function(r){var q=[],o=V(r),e,p,c,d,f=this.length===1&&this[0].parentNode;R=U||{};if(f&&f.nodeType===11&&f.childNodes.length===1&&o.length===1){o[b](this[0]);q=this}else{for(p=0,c=o.length;p<c;p++){T=p;e=(p>0?this.clone(true):this).get();V(o[p])[b](e);q=q.concat(e)}T=0;q=this.pushStack(q,a,o.selector)}d=R;R=null;V.tmpl.complete(d);return q}});V.fn.extend({tmpl:function(e,f,a){return V.tmpl(this[0],e,f,a)},tmplItem:function(){return V.tmplItem(this[0])},template:function(a){return V.template(a,this[0])},domManip:function(p,a,b){if(p[0]&&V.isArray(p[0])){var n=V.makeArray(arguments),l=p[0],c=l.length,e=0,o;while(e<c&&!(o=V.data(l[e++],"tmplItem"))){}if(o&&T){n[2]=function(d){V.tmpl.afterManip(this,d,b)}}E.apply(this,n)}else{E.apply(this,arguments)}T=0;!R&&V.tmpl.complete(U);return this}});V.extend({tmpl:function(j,f,g,l){var b,a=!l;if(a){l=G;j=V.template[j]||V.template(null,j);Q={}}else{if(!j){j=l.tmpl;U[l.key]=l;l.nodes=[];l.wrapped&&I(l,l.wrapped);return V(M(l,null,l.tmpl(V,l)))}}if(!j){return[]}if(typeof f==="function"){f=f.call(l||{})}g&&g.wrapped&&I(g,g.wrapped);b=V.isArray(f)?V.map(f,function(c){return c?P(g,l,j,c):null}):[P(g,l,j,f)];return a?V(M(l,null,b)):b},tmplItem:function(a){var d;if(a instanceof V){a=a[0]}while(a&&a.nodeType===1&&!(d=V.data(a,"tmplItem"))&&(a=a.parentNode)){}return d||G},template:function(d,a){if(a){if(typeof a==="string"){a=H(a)}else{if(a instanceof V){a=a[0]||{}}}if(a.nodeType){a=V.data(a,"tmpl")||V.data(a,"tmpl",H(a.innerHTML))}return typeof d==="string"?(V.template[d]=a):a}return d?typeof d!=="string"?V.template(null,d):V.template[d]||V.template(null,F.test(d)?d:V(d)):null},encode:function(b){return(""+b).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});V.extend(V.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){U={}},afterManip:function(c,a,h){var g=a.nodeType===11?V.makeArray(a.childNodes):a.nodeType===1?[a]:[];h.call(c,a);J(g);T++}});function M(i,d,h){var a,j=h?V.map(h,function(b){return typeof b==="string"?i.key?b.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+S+'="'+i.key+'" $2'):b:M(b,i,b._ctnt)}):i;if(d){return j}j=j.join("");j.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(b,l,g,k){a=V(g).get();J(a);if(l){a=L(l).concat(a)}if(k){a=a.concat(L(k))}});return a?a:L(j)}function L(d){var a=document.createElement("div");a.innerHTML=d;return V.makeArray(a.childNodes)}function H(a){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+V.trim(a).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(h,n,o,u,w,v,t){var p=V.tmpl.tag[o],q,s,r;if(!p){throw"Template command not found: "+o}q=p._default||[];if(v&&!/\w$/.test(w)){w+=v;v=""}if(w){w=O(w);t=t?","+O(t)+")":v?")":"";s=v?w.indexOf(".")>-1?w+O(v):"("+w+").call($item"+t:w;r=v?s:"(typeof("+w+")==='function'?("+w+").call($item):("+w+"))"}else{r=s=q.$1||"null"}u=O(u);return"');"+p[n?"close":"open"].split("$notnull_1").join(w?"typeof("+w+")!=='undefined' && ("+w+")!=null":"true").split("$1a").join(r).split("$1").join(s).split("$2").join(u?u.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(g,i,e,f){f=f?","+f+")":e?")":"";return f?"("+i+").call($item"+f:g}):q.$2||"")+"_.push('"})+"');}return _;")}function I(d,a){d._wrap=M(d,true,V.isArray(a)?a:[F.test(a)?a:V(a).html()]).join("")}function O(b){return b?b.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function D(c){var d=document.createElement("div");d.appendChild(c.cloneNode(true));return d.innerHTML}function J(b){var c="_"+T,g,i,f={},r,a,q;for(r=0,a=b.length;r<a;r++){if((g=b[r]).nodeType!==1){continue}i=g.getElementsByTagName("*");for(q=i.length-1;q>=0;q--){d(i[q])}d(g)}function d(s){var v,t=s,n,u,l;if(l=s.getAttribute(S)){while(t.parentNode&&(t=t.parentNode).nodeType===1&&!(v=t.getAttribute(S))){}if(v!==l){t=t.parentNode?t.nodeType===11?0:t.getAttribute(S)||0:0;if(!(u=U[l])){u=Q[l];u=P(u,U[t]||Q[t]);u.key=++N;U[N]=u}T&&w(l)}s.removeAttribute(S)}else{if(T&&(u=V.data(s,"tmplItem"))){w(u.key);U[u.key]=u;t=V.data(s.parentNode,"tmplItem");t=t?t.key:0}}if(u){n=u;while(n&&n.key!=t){n.nodes.push(s);n=n.parent}delete u._ctnt;delete u._wrap;V.data(s,"tmplItem",u)}function w(e){e=e+c;u=f[e]=f[e]||P(u,U[u.parent.key+c]||u.parent)}}}function B(f,g,h,e){if(!f){return K.pop()}K.push({_:f,tmpl:g,item:this,data:h,options:e})}function z(e,f,a){return V.tmpl(V.template(e),f,a,this)}function y(a,e){var f=a.options||{};f.wrapped=e;return V.tmpl(V.template(a.tmpl),a.data,f,a.item)}function A(e,f){var a=this._wrap;return V.map(V(V.isArray(a)?a.join(""):a).filter(e||"*"),function(b){return f?b.innerText||b.textContent:b.outerHTML||D(b)})}function C(){var a=this.nodes;V.tmpl(null,null,null,this).insertBefore(a[0]);V(a).remove()}})(jQuery);(function(d){var a="/j/cinema/search";var b="/j/cinema/suggest";function c(p,i){var f=300,g="",j={$city:d("#city-id"),$results:d("#cinemas-suggestion-list"),searchCallback:"",itemCallback:"",isAutoHide:true,tmpl:m},e=d.extend({},j,i),q=this,o="",k="";this.$input=p;this._interval=null;this.isAutoHide=e.isAutoHide;this.$results=e.$results;this.$city=e.$city;this.searchCallback=e.searchCallback;this.tmpl=e.tmpl;if(!p.length){return}function l(v){var r=d.trim(p.val()),t=a,u=q.$city.data("city-id"),s;if(o===r&&k===u){if(!q.$results.is(":visible")){n()}if(v){v.call(q)}return}else{k=u;o=r;if(g){g.abort()}if(!o.length){t=b}g=d.post_withck(t,{q:o,city_id:k},function(w){w=d.parseJSON(w);cinemas=w.cinemas;if(cinemas.length){s=q.tmpl(w,o);q.$results.html(s).show()}if(v){v.call(q)}})}}function m(x,u){var v,s,w,r=x.cinemas,t='{{if !keyword.length}}                                {{if data.src === "user"}}                                    <h4>常去影院</h4>                                {{/if}}                                {{if data.src === "ticket"}}                                    <h4>可售票影院</h4>                                {{/if}}                            {{/if}}                            <ul{{if !keyword.length}} class="auto-tip"{{/if}}>                                {{each(index, content) cinemas}}                                    <li>                                            <a data-id="{{= content.id}}" href="{{= content.url}}">                                            <strong>{{html content.name}}</strong>                                            {{if content.address}}                                                <p>{{html content.address}}</p>                                            {{/if}}                                        </a>                                    </li>                                {{/each}}                            </ul>';for(v=0;v<r.length;v++){s=r[v];if(u.length){s.name=s.name.replace(u,"<em>"+u+"</em>");s.address=s.address.replace(u,"<em>"+u+"</em>")}else{delete s.address}}w=d.tmpl(t,{data:x,keyword:u});return w}function n(){if(q.$results.find("li").length){q.$results.show()}}function h(u){var v=q.$results.find("li"),s=v.filter(".hover"),t=v.index(s),r=0;if(u==="up"){r=-1}else{if(u==="down"){r=1}}v.eq(t+r).addClass("hover");s.removeClass("hover")}p.attr("autocomplete","off");q.$results.delegate("li","hover",function(r){if(r.type==="mouseenter"){d(this).addClass("hover")}else{d(this).removeClass("hover")}}).delegate("li","click",function(r){r.preventDefault();if(d.isFunction(e.itemCallback)){e.itemCallback.call(q,this)}p.val(d(this).find("strong").text())});p.keydown(function(r){if(q.$results.is(":visible")){switch(r.keyCode){case 38:r.preventDefault();h("up");break;case 40:r.preventDefault();h("down");break;case 27:q.hide();break;case 13:r.preventDefault();q.done();break;default:break}}});q.$input.focus(function(s){q._clearTime();function r(){l(function(){q._interval=setTimeout(r,f)})}r()}).blur(function(){q._clearTime()});if(d("#cinemas-suggestion-search").length){d("#cinemas-suggestion-search").click(function(r){r.preventDefault();q.done()})}d("body").click(function(r){if(!d.contains(q.$results[0],r.target)&&!d(r.target).is("#cinemas-suggestion-input input")){q.hide()}})}c.prototype._clearTime=function(){if(this._interval){clearTimeout(this._interval);this._interval=null}return this};c.prototype.hide=function(){this._clearTime();if(this.isAutoHide){this.$results.hide()}return this};c.prototype.done=function(){var f=this;if(!f.$results.find(".hover").length){var e=d.trim(f.$input.val()),h=f.$city.data("city-id");if(d.isFunction(f.searchCallback)){f.searchCallback.call(f,e)}else{var g=(e===f.$input.attr("placeholder")?"/cinemas/"+h+"/":"/cinemas/"+h+"/?q="+e);window.location.href=g}}else{f.$results.find(".hover").click()}return this};d.fn.searchCinema=function(f,e){return new c(f,e)}})(jQuery);